# Description: Secure Sockets Layer and Transport Layer Security tools
# URL:         http://www.openssl.org/
# Maintainer:    CRUX System Team, core-ports at crux dot nu
# Arch Maintainer:  Lucas Hazel, lucas at die dot net dot au
# Depends on: openssl

name=openssl-compat32
version=0.9.8k
release=1
source=(http://www.openssl.org/source/openssl-$version.tar.gz)

build() {
    cd openssl-$version
    i386 ./config --prefix=/usr --openssldir=/etc/ssl shared
    
    # correct engines path
    sed -i -e "s|^#define ENGINESDIR.*|#define ENGINESDIR \"/usr/lib32/engines\"|g" \
	include/openssl/opensslconf.h \
	crypto/opensslconf.h

    if [ "$CC" ]; then
	find -name Makefile | xargs sed \
	    -e 's/$${CC}/"&"/' \
	    -e 's/$\(CC\)/"&"/' \
	    -i
    fi

    make -j1
    make INSTALL_PREFIX=$PKG MANDIR=/usr/man MANSUFFIX=ssl install
    
    mv $PKG/usr/lib $PKG/usr/lib32
    mv $PKG/usr/include $PKG/usr/include32
    find $PKG -name "*fips*" -delete
    sed -i \
	-e "s|\/lib|/lib32|g" \
	-e "s|\/include|/include32|g" \
	$PKG/usr/lib32/pkgconfig/*.pc
    chmod -R +w $PKG
    rm -rf $PKG/usr/{bin,man} $PKG/etc
}
