# Description: A popular vi clone that features syntax highlighting
# URL:         http://www.vim.org/
# Packager:    CRUX System Team, core-ports at crux dot nu
# Maintainer:  CRUX core developers, core-ports at crux dot nu
# Depends on:  ncurses

name=vim
version=7.0
release=6
source=(ftp://ftp.vim.org/pub/vim/unix/vim-$version.tar.bz2 \
        http://jue.li/crux/files/$name-7.0.001-109.tar.gz)

build () {
    cd $name${version/\./}

    for p in $SRC/$name-7.0.001-109/*; do
       patch -p0 -i $p
    done

    cd src
    ./configure --prefix=/usr \
		--with-vim-name=vim \
		--with-x=no \
		--enable-gui=no \
		--enable-multibyte \
		--disable-gpm \
		--disable-nls
    make VIMRTDIR=
    make VIMRTDIR= DESTDIR=$PKG installvimbin installruntime installlinks

    mv $PKG/usr/share/vim/vimrc_example.vim $PKG/usr/share/vim/vimrc
    rm -rf $PKG/usr/man/man?/vimtutor* $PKG/usr/share/vim/tutor $PKG/usr/share/vim/macros
    rm $PKG/usr/share/vim/*/README.txt    
    ln -sf vim $PKG/usr/bin/evim
    ln -sf /bin/vi $PKG/usr/bin/vi
    ln -sf vim.1.gz $PKG/usr/man/man1/ex.1.gz
    ln -sf vim.1.gz $PKG/usr/man/man1/vi.1.gz
    ln -sf vim.1.gz $PKG/usr/man/man1/rvim.1.gz
    ln -sf vim.1.gz $PKG/usr/man/man1/view.1.gz
    ln -sf vim.1.gz $PKG/usr/man/man1/rview.1.gz
    ln -sf vim.1.gz $PKG/usr/man/man1/gvim.1.gz

    ./configure --prefix=/ \
                --with-vim-name=vi \
                --with-x=no \
                --enable-gui=no \
                --enable-multibyte \
                --disable-gpm \
                --disable-nls \
                --with-features=tiny

    make VIMRTDIR= DESTDIR=$PKG installvimbin
}
